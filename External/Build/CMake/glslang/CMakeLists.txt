set(GLSLANG_PROJECT_DIR "${EXTERNAL_PROJECT_DIR}/glslang")
SET(GLSLANG_OUTPUT_DIR "${EXTERNAL_PROJECT_DIR}/lib/glslang/${KLAYGE_PLATFORM_NAME}")

UpdateExternalLib("glslang" "https://github.com/KhronosGroup/glslang.git" "bcf6a2430e99e8fc24f9f266e99316905e6d5134")

FOREACH(flag_var
		CMAKE_CXX_FLAGS_RELEASE CMAKE_CXX_FLAGS_RELWITHDEBINFO CMAKE_CXX_FLAGS_MINSIZEREL)
	STRING(REPLACE "${NO_RTTI_FLAG}" "${RTTI_FLAG}" ${flag_var} "${${flag_var}}")
ENDFOREACH()

set(BUILD_SHARED_LIBS OFF CACHE BOOL "" FORCE)
set(BUILD_EXTERNAL OFF CACHE BOOL "" FORCE)
set(BUILD_TESTING OFF CACHE BOOL "" FORCE)
set(ENABLE_HLSL ON CACHE BOOL "" FORCE)

ADD_SUBDIRECTORY(${GLSLANG_PROJECT_DIR} "${CMAKE_CURRENT_BINARY_DIR}/glslang")

SET_TARGET_PROPERTIES(glslang PROPERTIES
	ARCHIVE_OUTPUT_DIRECTORY ${GLSLANG_OUTPUT_DIR}
	ARCHIVE_OUTPUT_DIRECTORY_DEBUG ${GLSLANG_OUTPUT_DIR}
	ARCHIVE_OUTPUT_DIRECTORY_RELEASE ${GLSLANG_OUTPUT_DIR}
	ARCHIVE_OUTPUT_DIRECTORY_RELWITHDEBINFO ${GLSLANG_OUTPUT_DIR}
	ARCHIVE_OUTPUT_DIRECTORY_MINSIZEREL ${GLSLANG_OUTPUT_DIR}
	RUNTIME_OUTPUT_DIRECTORY ${KLAYGE_BIN_DIR}
	RUNTIME_OUTPUT_DIRECTORY_DEBUG ${KLAYGE_BIN_DIR}
	RUNTIME_OUTPUT_DIRECTORY_RELEASE ${KLAYGE_BIN_DIR}
	RUNTIME_OUTPUT_DIRECTORY_RELWITHDEBINFO ${KLAYGE_BIN_DIR}
	RUNTIME_OUTPUT_DIRECTORY_MINSIZEREL ${KLAYGE_BIN_DIR}
	LIBRARY_OUTPUT_DIRECTORY ${KLAYGE_BIN_DIR}
	LIBRARY_OUTPUT_DIRECTORY_DEBUG ${KLAYGE_BIN_DIR}
	LIBRARY_OUTPUT_DIRECTORY_RELEASE ${KLAYGE_BIN_DIR}
	LIBRARY_OUTPUT_DIRECTORY_RELWITHDEBINFO ${KLAYGE_BIN_DIR}
	LIBRARY_OUTPUT_DIRECTORY_MINSIZEREL ${KLAYGE_BIN_DIR}
	DEBUG_POSTFIX ${CMAKE_DEBUG_POSTFIX}
	OUTPUT_NAME glslang${KLAYGE_OUTPUT_SUFFIX}
)

foreach(target
    "glslang" "glslang-default-resource-limits" "OGLCompiler" "OSDependent" "SPIRV" "HLSL")
    set_target_properties(${target} PROPERTIES FOLDER "External/glslang")
endforeach()
